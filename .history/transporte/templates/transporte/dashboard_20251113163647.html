<!-- transporte/dashboard.html -->
{% extends 'base.html' %}

{% block title %}Dashboard - LogÃ­stica Global{% endblock %}

{% block content %}
<div class="page-title">
    <span>ğŸ“Š</span>
    <span>Dashboard</span>
</div>

<!-- Tarjetas de EstadÃ­sticas -->
<div class="stats-grid">
    <div class="stat-card" onclick="window.location.href='{% url 'despachos' %}'">
        <div class="stat-icon" style="background: rgba(99, 102, 241, 0.2);">ğŸ“¦</div>
        <div class="stat-info">
            <div class="stat-value">{{ total_despachos }}</div>
            <div class="stat-label">Total Despachos</div>
        </div>
    </div>
    
    <div class="stat-card" onclick="window.location.href='{% url 'despachos' %}?estado=PENDIENTE'">
        <div class="stat-icon" style="background: rgba(245, 158, 11, 0.2);">â³</div>
        <div class="stat-info">
            <div class="stat-value">{{ despachos_pendientes }}</div>
            <div class="stat-label">Pendientes</div>
        </div>
    </div>
    
    <div class="stat-card" onclick="window.location.href='{% url 'despachos' %}?estado=EN_RUTA'">
        <div class="stat-icon" style="background: rgba(59, 130, 246, 0.2);">ğŸšš</div>
        <div class="stat-info">
            <div class="stat-value">{{ despachos_en_ruta }}</div>
            <div class="stat-label">En Ruta</div>
        </div>
    </div>
    
    <div class="stat-card" onclick="window.location.href='{% url 'despachos' %}?estado=ENTREGADO'">
        <div class="stat-icon" style="background: rgba(16, 185, 129, 0.2);">âœ…</div>
        <div class="stat-info">
            <div class="stat-value">{{ despachos_entregados }}</div>
            <div class="stat-label">Entregados</div>
        </div>
    </div>
</div>

<!-- Grid Principal -->
<div class="dashboard-grid">
    <!-- Ãšltimos Despachos -->
    <div class="content-card">
        <div class="card-header">
            <h3>ğŸ“¦ Ãšltimos Despachos</h3>
            <a href="{% url 'despachos' %}" class="btn btn-secondary">Ver Todos</a>
        </div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Cliente</th>
                        <th>Ruta</th>
                        <th>Estado</th>
                        <th>Fecha</th>
                    </tr>
                </thead>
                <tbody>
                    {% for despacho in ultimos_despachos %}
                    <tr>
                        <td>D-{{ despacho.id|stringformat:"04d" }}</td>
                        <td>{{ despacho.cliente.razon_social }}</td>
                        <td>{{ despacho.ruta.origen }} - {{ despacho.ruta.destino }}</td>
                        <td>
                            <span class="badge 
                                {% if despacho.estado == 'ENTREGADO' %}active
                                {% elif despacho.estado == 'PENDIENTE' %}pending
                                {% elif despacho.estado == 'EN_RUTA' %}info
                                {% else %}alert{% endif %}">
                                {{ despacho.get_estado_display }}
                            </span>
                        </td>
                        <td>{{ despacho.fecha_despacho|date:"d/m/Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; color: var(--text-secondary);">
                            No hay despachos recientes
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Resumen de Flota -->
    <div class="content-card">
        <div class="card-header">
            <h3>ğŸš— Estado de Flota</h3>
        </div>
        <div class="flota-stats">
            <div class="flota-item" onclick="window.location.href='{% url 'vehiculos' %}'">
                <div class="flota-icon">ğŸš›</div>
                <div class="flota-info">
                    <div class="flota-value">{{ total_vehiculos }}</div>
                    <div class="flota-label">VehÃ­culos Activos</div>
                </div>
            </div>
            <div class="flota-item" onclick="window.location.href='{% url 'aeronaves' %}'">
                <div class="flota-icon">âœˆï¸</div>
                <div class="flota-info">
                    <div class="flota-value">{{ total_aeronaves }}</div>
                    <div class="flota-label">Aeronaves Activas</div>
                </div>
            </div>
            <div class="flota-item" onclick="window.location.href='{% url 'conductores' %}'">
                <div class="flota-icon">ğŸ‘¨â€ğŸ’¼</div>
                <div class="flota-info">
                    <div class="flota-value">{{ total_conductores }}</div>
                    <div class="flota-label">Conductores</div>
                </div>
            </div>
            <div class="flota-item" onclick="window.location.href='{% url 'pilotos' %}'">
                <div class="flota-icon">ğŸ‘¨â€âœˆï¸</div>
                <div class="flota-info">
                    <div class="flota-value">{{ total_pilotos }}</div>
                    <div class="flota-label">Pilotos</div>
                </div>
            </div>
            <div class="flota-item" onclick="window.location.href='{% url 'clientes' %}'">
                <div class="flota-icon">ğŸ‘¥</div>
                <div class="flota-info">
                    <div class="flota-value">{{ total_clientes }}</div>
                    <div class="flota-label">Clientes</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Acciones RÃ¡pidas -->
<div class="content-card">
    <div class="card-header">
        <h3>âš¡ Acciones RÃ¡pidas</h3>
    </div>
    <div class="action-buttons">
        <a href="{% url 'despacho_crear' %}" class="btn">â• Nuevo Despacho</a>
        <a href="{% url 'vehiculos' %}" class="btn btn-secondary">ğŸš› Gestionar VehÃ­culos</a>
        <a href="{% url 'aeronaves' %}" class="btn btn-secondary">âœˆï¸ Gestionar Aeronaves</a>
        <a href="{% url 'clientes' %}" class="btn btn-secondary">ğŸ‘¥ Gestionar Clientes</a>
        <a href="{% url 'reportes' %}" class="btn btn-success">ğŸ“Š Ver Reportes</a>
    </div>
</div>

<style>
    .table-container {
        background: transparent;
        border: none;
        padding: 0;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table th {
        text-align: left;
        padding: 1rem;
        background: rgba(51, 65, 85, 0.3);
        font-weight: 600;
        color: var(--text-secondary);
        border-bottom: 1px solid var(--border);
    }

    .table td {
        padding: 1rem;
        border-bottom: 1px solid var(--border);
    }

    .table tr:last-child td {
        border-bottom: none;
    }

    .table tr:hover {
        background: rgba(51, 65, 85, 0.2);
    }
</style>

<script>
    // Funciones especÃ­ficas del dashboard
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸ“Š Dashboard cargado exitosamente');
        
        // AnimaciÃ³n para las tarjetas de estadÃ­sticas
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
    });

    // FunciÃ³n para crear nuevo despacho
    function createNewDespacho() {
        showNotification('Redirigiendo a creaciÃ³n de despacho...');
        setTimeout(() => {
            window.location.href = '{% url 'despacho_crear' %}';
        }, 1000);
    }
</script>
{% endblock %}